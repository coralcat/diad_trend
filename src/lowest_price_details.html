{% extends "base.html" %} {% block content %} {% import 'aside.html' as menu %} {{menu.active('lowestPrice')}}
<script>
  $(function () {
    var dateFormat = "yy-mm-dd",
      from = $("#lowestPriceChartFrom")
        .datepicker()
        .on("change", function () {
          to.datepicker("option", "minDate", getDate(this));
        }),
      to = $("#lowestPriceChartTo")
        .datepicker()
        .on("change", function () {
          from.datepicker("option", "maxDate", getDate(this));
        });

    function getDate(element) {
      var date;
      try {
        date = $.datepicker.parseDate(dateFormat, element.value);
      } catch (error) {
        date = null;
      }

      return date;
    }
    var dateFormat = "yy-mm-dd",
      from = $("#priceChartFrom")
        .datepicker()
        .on("change", function () {
          to.datepicker("option", "minDate", getDate(this));
        }),
      to = $("#priceChartTo")
        .datepicker()
        .on("change", function () {
          from.datepicker("option", "maxDate", getDate(this));
        });

    function getDate(element) {
      var date;
      try {
        date = $.datepicker.parseDate(dateFormat, element.value);
      } catch (error) {
        date = null;
      }

      return date;
    }
  });
</script>
<script>
  $(function () {
    var dateFormat = "yy-mm-dd",
      from = $("#dailyLowestPriceChartFrom")
        .datepicker()
        .on("change", function () {
          to.datepicker("option", "minDate", getDate(this));
        }),
      to = $("#dailyLowestPriceChartTo")
        .datepicker()
        .on("change", function () {
          from.datepicker("option", "maxDate", getDate(this));
        });

    function getDate(element) {
      var date;
      try {
        date = $.datepicker.parseDate(dateFormat, element.value);
      } catch (error) {
        date = null;
      }

      return date;
    }
    var dateFormat = "yy-mm-dd",
      from = $("#priceChartFrom")
        .datepicker()
        .on("change", function () {
          to.datepicker("option", "minDate", getDate(this));
        }),
      to = $("#priceChartTo")
        .datepicker()
        .on("change", function () {
          from.datepicker("option", "maxDate", getDate(this));
        });

    function getDate(element) {
      var date;
      try {
        date = $.datepicker.parseDate(dateFormat, element.value);
      } catch (error) {
        date = null;
      }

      return date;
    }
  });
</script>
<script>
  am5.ready(function () {
    var root = am5.Root.new("keywordChart");
    root.setThemes([am5themes_Animated.new(root)]);

    var chart = root.container.children.push(am5xy.XYChart.new(root, { layout: root.verticalLayout }));

    // Generate random data
    var date = new Date();
    date.setHours(0, 0, 0, 0);
    var value = 100;

    var data = [
      {
        date: new Date(2021, 2, 1).getTime(),
        keyword01: 1,
        keword02: 5,
        keyowrd03: 3,
      },
      {
        date: new Date(2021, 2, 2).getTime(),
        keyword01: 1,
        keword02: 2,
        keyowrd03: 6,
      },
      {
        date: new Date(2021, 2, 3).getTime(),
        keyword01: 2,
        keword02: 3,
        keyowrd03: 1,
      },
      {
        date: new Date(2021, 2, 4).getTime(),
        keyword01: 3,
        keword02: 4,
        keyowrd03: 1,
      },
      {
        date: new Date(2021, 2, 5).getTime(),
        keyword01: 5,
        keword02: 1,
        keyowrd03: 2,
      },
      {
        date: new Date(2021, 2, 6).getTime(),
        keyword01: 3,
        keword02: 2,
        keyowrd03: 1,
      },
      {
        date: new Date(2021, 2, 7).getTime(),
        keyword01: 1,
        keword02: 2,
        keyowrd03: 3,
      },
      {
        date: new Date(2021, 2, 8).getTime(),
        keyword01: 2,
        keword02: 1,
        keyowrd03: 5,
      },
      {
        date: new Date(2021, 2, 9).getTime(),
        keyword01: 3,
        keword02: 5,
        keyowrd03: 2,
      },
    ];

    var xRenderer = am5xy.AxisRendererX.new(root, {});
    xRenderer.grid.template.set("location", 0.5);
    xRenderer.labels.template.setAll({
      location: 0.5,
      multiLocation: 0.5,
    });

    var xAxis = chart.xAxes.push(
      am5xy.DateAxis.new(root, {
        baseInterval: { timeUnit: "day", count: 1 },
        renderer: xRenderer,
        tooltip: am5.Tooltip.new(root, {}),
      })
    );
    xAxis.get("dateFormats")["day"] = "yyyy/MM/dd";
    xAxis.data.setAll(data);

    var yAxis = chart.yAxes.push(
      am5xy.ValueAxis.new(root, {
        renderer: am5xy.AxisRendererY.new(root, {
          inversed: true,
        }),
      })
    );

    function createSeries(name, field) {
      var series = chart.series.push(
        am5xy.LineSeries.new(root, {
          name: name,
          xAxis: xAxis,
          yAxis: yAxis,
          valueYField: field,
          valueXField: "date",
          tooltip: am5.Tooltip.new(root, {
            pointerOrientation: "horizontal",
            labelText: "[bold]{name} {valueY}[/]위",
          }),
        })
      );

      series.bullets.push(function () {
        return am5.Bullet.new(root, {
          sprite: am5.Circle.new(root, {
            radius: 3,
            fill: series.get("fill"),
          }),
        });
      });

      // create hover state for series and for mainContainer, so that when series is hovered,
      // the state would be passed down to the strokes which are in mainContainer.
      series.set("setStateOnChildren", true);
      series.states.create("hover", {});

      series.mainContainer.set("setStateOnChildren", true);
      series.mainContainer.states.create("hover", {});

      series.strokes.template.states.create("hover", {
        strokeWidth: 4,
      });

      series.data.setAll(data);
      series.appear(1000, 100);
    }

    createSeries("싱글오리진", "keyword01");
    createSeries("커피원두", "keword02");
    createSeries("스타벅스", "keyowrd03");

    var cursor = chart.set(
      "cursor",
      am5xy.XYCursor.new(root, {
        behavior: "none",
      })
    );
    cursor.lineY.set("visible", false);

    var legend = chart.rightAxesContainer.children.push(
      am5.Legend.new(root, {
        width: 150,
        paddingLeft: 15,
        height: am5.percent(100),
      })
    );

    // When legend item container is hovered, dim all the series except the hovered one
    legend.itemContainers.template.events.on("pointerover", function (e) {
      var itemContainer = e.target;

      // As series list is data of a legend, dataContext is series
      var series = itemContainer.dataItem.dataContext;

      chart.series.each(function (chartSeries) {
        if (chartSeries != series) {
          chartSeries.strokes.template.setAll({
            strokeOpacity: 0.15,
            stroke: am5.color(0x000000),
          });
        } else {
          chartSeries.strokes.template.setAll({
            strokeWidth: 3,
          });
        }
      });
    });

    // When legend item container is unhovered, make all series as they are
    legend.itemContainers.template.events.on("pointerout", function (e) {
      var itemContainer = e.target;
      var series = itemContainer.dataItem.dataContext;

      chart.series.each(function (chartSeries) {
        chartSeries.strokes.template.setAll({
          strokeOpacity: 1,
          strokeWidth: 1,
          stroke: chartSeries.get("fill"),
        });
      });
    });

    legend.itemContainers.template.set("width", am5.p100);
    legend.valueLabels.template.setAll({
      width: am5.p100,
      textAlign: "right",
    });

    legend.data.setAll(chart.series.values);
    chart.appear(1000, 100);
  }); // end am5.ready()
</script>
<script>
  am5.ready(function () {
    var root = am5.Root.new("priceChart");
    root.setThemes([am5themes_Animated.new(root)]);

    var chart = root.container.children.push(am5xy.XYChart.new(root, {}));

    var cursor = chart.set(
      "cursor",
      am5xy.XYCursor.new(root, {
        behavior: "none",
      })
    );
    cursor.lineY.set("visible", false);

    // Generate random data
    var date = new Date();
    date.setHours(0, 0, 0, 0);
    var value = 9900;
    var previousValue = value;
    var downColor = root.interfaceColors.get("negative");
    var upColor = root.interfaceColors.get("positive");
    var color;
    var previousColor;
    var previousDataObj;

    function generateData() {
      value = Math.round(Math.random() * 10 - 5 + value);
      am5.time.add(date, "day", 1);

      if (value >= previousValue) {
        color = upColor;
      } else {
        color = downColor;
      }
      previousValue = value;

      var dataObj = { date: date.getTime(), value: value, color: color }; // color will be used for tooltip background

      // only if changed
      if (color != previousColor) {
        if (!previousDataObj) {
          previousDataObj = dataObj;
        }
        previousDataObj.strokeSettings = { stroke: color };
      }

      previousDataObj = dataObj;
      previousColor = color;

      return dataObj;
    }

    function generateDatas(count) {
      var data = [];
      for (var i = 0; i < count; ++i) {
        data.push(generateData());
      }
      return data;
    }

    // Create axes
    // https://www.amcharts.com/docs/v5/charts/xy-chart/axes/
    var xAxis = chart.xAxes.push(
      am5xy.DateAxis.new(root, {
        baseInterval: { timeUnit: "day", count: 1 },
        renderer: am5xy.AxisRendererX.new(root, {}),
        tooltip: am5.Tooltip.new(root, {}),
      })
    );

    var yAxis = chart.yAxes.push(
      am5xy.ValueAxis.new(root, {
        renderer: am5xy.AxisRendererY.new(root, {}),
      })
    );

    // Add series
    // https://www.amcharts.com/docs/v5/charts/xy-chart/series/
    var series = chart.series.push(
      am5xy.LineSeries.new(root, {
        name: "Series",
        xAxis: xAxis,
        yAxis: yAxis,
        valueYField: "value",
        valueXField: "date",
      })
    );

    series.strokes.template.set("templateField", "strokeSettings");

    var tooltip = series.set(
      "tooltip",
      am5.Tooltip.new(root, {
        labelText: "{valueY}",
      })
    );

    // this is added in ored adapter to be triggered each time position changes
    tooltip.on("pointTo", function () {
      var background = tooltip.get("background");
      background.set("fill", background.get("fill"));
    });

    // tooltip bacground takes color from data item
    tooltip.get("background").adapters.add("fill", function (fill) {
      if (tooltip.dataItem) {
        return tooltip.dataItem.dataContext.color;
      }
      return fill;
    });

    // Create axis ranges
    function createRange(value, endValue, color) {
      var rangeDataItem = yAxis.makeDataItem({
        value: value,
        endValue: endValue,
      });

      var range = yAxis.createAxisRange(rangeDataItem);

      if (endValue) {
        rangeDataItem.get("axisFill").setAll({
          fill: color,
          fillOpacity: 0.2,
          visible: true,
        });

        rangeDataItem.get("label").setAll({
          fill: am5.color(0xffffff),
          text: value + "-" + endValue,
          location: 1,
          background: am5.RoundedRectangle.new(root, {
            fill: color,
          }),
        });
      } else {
        rangeDataItem.get("label").setAll({
          fill: am5.color(0xffffff),
          text: value,
          background: am5.RoundedRectangle.new(root, {
            fill: color,
          }),
        });
      }

      rangeDataItem.get("grid").setAll({
        stroke: color,
        strokeOpacity: 1,
        location: 1,
      });
    }

    createRange(9900, undefined, am5.color(0x297373));

    var data = generateDatas(100);
    series.data.setAll(data);

    series.appear(1000);
    chart.appear(1000, 100);
  }); // end am5.ready()
</script>
<div class="content content-lowest-price-details">
  <header class="main-header">
    <section class="title">
      <h1>
        <span>상품 최저가 리포트</span>
      </h1>
    </section>
    <section class="section-main">
      <header class="section-header">
        <div>
          <div class="tag-failed">
            <span class="failed">갱신실패</span>
            <span class="success">2022-03-01 12:00</span>
          </div>
        </div>
        <a href="https://search.shopping.naver.com/gate.nhn?id=12126547821" class="right-arrow" target="_blank"
          >가격비교 상품페이지로 이동</a
        >
      </header>
      <div class="information">
        <div class="image">
          <img src="https://shopping-phinf.pstatic.net/main_1212654/12126547821.9.jpg?type=f160" alt="" />
        </div>
        <div class="list">
          <ul class="row">
            <li class="title">상품 MID</li>
            <li>12126547821</li>
          </ul>
          <ul class="row">
            <li class="title">상품명</li>
            <li>1kg 커피창고 에티오피아 예가체프 케냐AA 콜롬비아 수프리모 과테말라 안티구아 브라질 세하도...</li>
          </ul>
          <ul class="row">
            <li class="title">판매가</li>
            <li>9,900원</li>
          </ul>
          <ul class="row">
            <li class="title">브랜드</li>
            <li>커피창고</li>
            <li class="title">제조사</li>
            <li>주식회사 커피창고</li>
          </ul>
          <ul class="row">
            <li class="title">카테고리</li>
            <li>식품 > 음료 > 커피 > 원두/생두</li>
          </ul>
        </div>
      </div>
    </section>
  </header>
  <div class="wrapper">
    <section>
      <header class="section-header multi-line">
        <div class="title">
          <h3>
            <span>최저가 차트</span>
            <div class="tooltip">
              <div class="ico-tooltip"></div>
              <article class="tooltip-content">
                <ul>
                  <li>상품의 최저가 변동을 한눈에 확인할 수 있는 차트입니다.</li>
                  <li>기간을 설정하여 원하는 데이터를 얻을 수 있습니다.</li>
                  <li>등록일부터 데이터가 갱신됨으로 등록 후 초반에는 기간 설정에 제한이 있을 수 있습니다.</li>
                </ul>
              </article>
            </div>
          </h3>
          <div class="buttons">
            <button class="ico-download" type="button">엑셀다운</button>
          </div>
        </div>
        <div class="filters">
          <div>
            <div class="period">
              <input type="radio" id="select-1day" name="keyword-chart" checked />
              <label for="select-1day">1일</label>
              <input type="radio" id="select-1week" name="keyword-chart" />
              <label for="select-1week">1주</label>
              <input type="radio" id="select-1month" name="keyword-chart" />
              <label for="select-1month">1개월</label>
              <input type="radio" id="select-6months" name="keyword-chart" />
              <label for="select-6months">6개월</label>
              <input type="radio" id="select-1year" name="keyword-chart" />
              <label for="select-1year">1년</label>
            </div>
            <div class="calendar">
              <input type="text" id="lowestPriceChartFrom" name="" />
              <span>~</span>
              <input type="text" id="lowestPriceChartTo" name="" />
            </div>
            <button type="button">조회</button>
          </div>
          <div class="selectbox">
            <span>그래프간격</span>
            <select name="" id="">
              <option value="">1일 00:00</option>
              <option value="">1일 12:00</option>
              <option value="">1주 00:00</option>
              <option value="">1주 12:00</option>
              <option value="">1개월 00:00</option>
              <option value="">1개월 12:00</option>
            </select>
          </div>
        </div>
      </header>
      <div class="keyword-chart">
        <div class="chart-container" data-empty="데이터 갱신 전입니다.">
          <div id="keywordChart" class="chart"></div>
        </div>
      </div>
    </section>
    <section>
      <header class="section-header multi-line">
        <div class="title">
          <h3>
            <span>일별 최저가</span>
            <div class="tooltip">
              <div class="ico-tooltip"></div>
              <article class="tooltip-content">
                <ul>
                  <li>최저가의 일별 추이를 알 수 있습니다.</li>
                  <li>기간을 설정하여 원하는 데이터를 얻을 수 있습니다.</li>
                  <li>차트 클릭 시 해당 일의 최저가 차트를 보실 수 있습니다.</li>
                  <li>등록일부터 데이터가 갱신됨으로 등록 후 초반에는 기간 설정에 제한이 있을 수 있습니다.</li>
                </ul>
              </article>
            </div>
          </h3>
          <div class="buttons">
            <button class="ico-download" type="button">엑셀다운</button>
          </div>
        </div>
        <div class="filters">
          <div>
            <div class="period">
              <input type="radio" id="select-1day" name="keyword-chart" checked />
              <label for="select-1day">1일</label>
              <input type="radio" id="select-1week" name="keyword-chart" />
              <label for="select-1week">1주</label>
              <input type="radio" id="select-1month" name="keyword-chart" />
              <label for="select-1month">1개월</label>
              <input type="radio" id="select-6months" name="keyword-chart" />
              <label for="select-6months">6개월</label>
              <input type="radio" id="select-1year" name="keyword-chart" />
              <label for="select-1year">1년</label>
            </div>
            <div class="calendar">
              <input type="text" id="dailyLowestPriceChartFrom" name="" />
              <span>~</span>
              <input type="text" id="dailyLowestPriceChartTo" name="" />
            </div>
            <button type="button">조회</button>
          </div>
        </div>
      </header>
      <div class="list list-daily-lowest-price">
        <ul class="row title">
          <li class="sort">날짜</li>
          <li class="sort">차트</li>
          <li class="sort">평균</li>
          <li class="sort">전일대비</li>
          <li class="sort">등락율</li>
          <li class="sort">고가</li>
          <li class="sort">저가</li>
        </ul>
        <ul class="row failed">
          <li>2022-03-01</li>
          <li class="col-chart" data-modal-chart=""></li>
          <li class="price">-</li>
          <li>
            <div class="rank failed"></div>
          </li>
          <li>
            <div class="percent failed"></div>
          </li>
          <li class="price">-</li>
          <li class="price">-</li>
        </ul>
        <ul class="row">
          <li>2022-02-28</li>
          <li class="col-chart" data-modal-chart=""></li>
          <li class="price">9,800</li>
          <li>
            <div class="rank down">90</div>
          </li>
          <li>
            <div class="percent down">0.91</div>
          </li>
          <li class="price">9,920</li>
          <li class="price">9,880</li>
        </ul>
        <ul class="row">
          <li>2022-02-27</li>
          <li class="col-chart" data-modal-chart=""></li>
          <li class="price">9,890</li>
          <li>
            <div class="rank same"></div>
          </li>
          <li>
            <div class="percent up">0.00</div>
          </li>
          <li class="price">9,920</li>
          <li class="price">9,880</li>
        </ul>
        <ul class="row">
          <li>2022-02-26</li>
          <li class="col-chart" data-modal-chart=""></li>
          <li class="price">9,890</li>
          <li>
            <div class="rank down">100</div>
          </li>
          <li>
            <div class="percent down">1.00</div>
          </li>
          <li class="price">9,880</li>
          <li class="price">9,920</li>
        </ul>
      </div>
    </section>
  </div>
</div>

<div class="modal edit-keyword">
  <div class="dialog">
    <header class="modal-header">
      <h3>키워드 편집</h3>
      <div class="close"></div>
    </header>
    <div class="modal-content">
      <section class="section-impact">
        <div class="title">등록 가능한 상품 순위 조회 소재는 10 개 입니다.</div>
        <a href="#" class="right-arrow">등록 가능 소재 개수 추가방법</a>
      </section>
      <section class="inputs">
        <p>등록하실 키워드를 추가해주세요.</p>
        <input type="text" placeholder="키워드를 입력해주세요." />
        <button class="btn-sub" type="button" data-modal-alert="create-keyword">키워드추가</button>
        <small class="input-alert">키워드를 입력해주세요.</small>
      </section>
      <section>
        <div class="list-header">
          <ul class="list-count">
            <li>
              <span class="selected">0</span>
            </li>
            <li>
              <span class="total">9</span>
            </li>
          </ul>
          <button class="btn-grayscale" type="button" data-modal-confirm="check-delete-keyword">선택삭제</button>
        </div>
        <div class="list">
          <ul class="row title">
            <li class="col-check">
              <div class="checkbox">
                <input id="createKeywordCheckAll" type="checkbox" name="createKeywordCheck" class="check-all" />
                <label for="createKeywordCheckAll"></label>
              </div>
            </li>
            <li>전체</li>
          </ul>
          <div class="rows" data-empty="키워드를 추가해주세요.">
            <ul class="row">
              <li class="col-check">
                <div class="checkbox">
                  <input id="check1" type="checkbox" name="createKeywordCheck" />
                  <label for="check1"></label>
                </div>
              </li>
              <li class="keyword">커피</li>
            </ul>
            <ul class="row">
              <li class="col-check">
                <div class="checkbox">
                  <input id="check2" type="checkbox" name="createKeywordCheck" />
                  <label for="check2"></label>
                </div>
              </li>
              <li class="keyword">커피원두</li>
            </ul>
            <ul class="row">
              <li class="col-check">
                <div class="checkbox">
                  <input id="check3" type="checkbox" name="createKeywordCheck" />
                  <label for="check3"></label>
                </div>
              </li>
              <li class="keyword">원두커피</li>
            </ul>
            <ul class="row">
              <li class="col-check">
                <div class="checkbox">
                  <input id="check4" type="checkbox" name="createKeywordCheck" />
                  <label for="check4"></label>
                </div>
              </li>
              <li class="keyword">커피</li>
            </ul>
            <ul class="row">
              <li class="col-check">
                <div class="checkbox">
                  <input id="check5" type="checkbox" name="createKeywordCheck" />
                  <label for="check5"></label>
                </div>
              </li>
              <li class="keyword">커피원두</li>
            </ul>
            <ul class="row">
              <li class="col-check">
                <div class="checkbox">
                  <input id="check6" type="checkbox" name="createKeywordCheck" />
                  <label for="check6"></label>
                </div>
              </li>
              <li class="keyword">원두커피</li>
            </ul>
            <ul class="row">
              <li class="col-check">
                <div class="checkbox">
                  <input id="check7" type="checkbox" name="createKeywordCheck" />
                  <label for="check7"></label>
                </div>
              </li>
              <li class="keyword">원두커피</li>
            </ul>
          </div>
        </div>
      </section>
    </div>
    <div class="buttons">
      <button class="btn-main close" type="button">닫기</button>
    </div>
  </div>
</div>

<div class="modal change-details">
  <div class="dialog">
    <header class="modal-header">
      <h3>변경사항</h3>
      <div class="close"></div>
    </header>
    <div class="modal-content">
      <div class="list">
        <ul class="row">
          <li>상품명</li>
          <li>
            <div class="row">
              <div class="date">2022-03-01 18:00</div>
              <div class="current">1kg 커피창고 에티오피아 예가체프 케냐AAA 싱글오리진</div>
            </div>
            <div class="row">
              <div class="date">2022-03-01 17:00</div>
              <div class="before">커피창고 원두 1kg 에티오피아</div>
            </div>
          </li>
        </ul>
        <ul class="row">
          <li>스토어명</li>
          <li>커피창고</li>
        </ul>
        <ul class="row">
          <li>판매가</li>
          <li>
            <div class="row">
              <div class="date">2022-03-01 18:00</div>
              <div class="current price">10,900</div>
            </div>
            <div class="row">
              <div class="date">2022-03-01 17:00</div>
              <div class="before price">9,900</div>
            </div>
          </li>
        </ul>
        <ul class="row">
          <li>브랜드</li>
          <li>커피창고</li>
        </ul>
        <ul class="row">
          <li>제조사</li>
          <li>주식회사 커피창고</li>
        </ul>
        <ul class="row">
          <li>카테고리</li>
          <li>식품 &gt; 음료 &gt; 커피 &gt; 원두/생두</li>
        </ul>
      </div>
    </div>
    <div class="buttons">
      <button class="btn-main close" type="button">닫기</button>
    </div>
  </div>
</div>

<div class="modal modal-confirm">
  <div class="dialog">
    <header class="modal-header">
      <div class="close"></div>
    </header>
    <div class="modal-content"></div>
    <div class="buttons">
      <button class="btn-cancel close" type="button">아니오</button>
      <button class="btn-submit" type="button">예</button>
    </div>
  </div>
</div>

<div class="modal modal-alert">
  <div class="dialog">
    <div class="modal-content"></div>
    <div class="buttons">
      <button class="btn-submit close" type="button">확인</button>
    </div>
  </div>
</div>

<div class="modal modal-chart">
  <div class="dialog">
    <header class="modal-header">
      <h3>2022-03-01</h3>
      <div class="close"></div>
    </header>
    <div class="modal-content">
      <div class="chart" id="priceChart"></div>
    </div>
  </div>
</div>
{% endblock %}
